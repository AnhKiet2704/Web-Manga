{% extends 'base.html' %}

{% block title %}{{ manga.title }} - ƒê·ªçc truy·ªán{% endblock %}

{% block content %}
<div class="manga-detail">
    <div class="manga-info-section">
        <div class="manga-cover-large">
            <img src="{{ manga.cover_image.url }}" alt="{{ manga.title }}">
        </div>

        <div class="manga-details">
            <h1 class="manga-title-large">{{ manga.title }}</h1>

            {% if manga.alternative_title %}
            <p class="alt-title">{{ manga.alternative_title }}</p>
            {% endif %}

            <div class="manga-meta">
                <div class="meta-item">
                    <span class="label">T√°c gi·∫£:</span>
                    <span class="value">{{ manga.author.name }}</span>
                </div>

                <div class="meta-item">
                    <span class="label">Tr·∫°ng th√°i:</span>
                    <span class="value status-{{ manga.status }}">{{ manga.get_status_display }}</span>
                </div>

                <div class="meta-item">
                    <span class="label">L∆∞·ª£t xem:</span>
                    <span class="value">üëÅ {{ manga.views }}</span>
                </div>

                <div class="meta-item">
                    <span class="label">ƒê√°nh gi√°:</span>
                    <span class="value">‚≠ê {{ avg_rating }}/5</span>
                </div>
            </div>

            <div class="manga-categories">
                <span class="label">Th·ªÉ lo·∫°i:</span>
                {% for category in manga.categories.all %}
                <a href="/category/{{ category.slug }}/" class="category-tag">
                    {{ category.name }}
                </a>
                {% endfor %}
            </div>

            <div class="manga-actions">
                <form action="/follow/{{ manga.id }}/" method="post">
                    {% csrf_token %}
                    {% if is_following %}
                    <button type="submit" class="btn btn-secondary">‚ùå B·ªè theo d√µi</button>
                    {% else %}
                    <button type="submit" class="btn btn-primary">‚ù§Ô∏è Theo d√µi</button>
                    {% endif %}
                </form>

                {% if chapters %}
                <a href="/manga/{{ manga.slug }}/{{ chapters.0.slug }}/" class="btn btn-success">
                    üìñ ƒê·ªçc ngay
                </a>
                {% endif %}
            </div>

            <!-- Rating -->
            {% if user.is_authenticated %}
            <div class="rating-section">
                <h3>ƒê√°nh gi√° truy·ªán n√†y</h3>
                <form action="/rate/{{ manga.id }}/" method="post" class="rating-form">
                    {% csrf_token %}
                    <div class="star-rating">
                        {% for i in "12345" %}
                        <input type="radio" name="score" value="{{ forloop.counter }}" id="star{{ forloop.counter }}">
                        <label for="star{{ forloop.counter }}">{{ forloop.counter }}</label>
                        {% endfor %}
                    </div>
                    <button type="submit" class="btn btn-small">G·ª≠i ƒë√°nh gi√°</button>
                </form>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="manga-description">
        <h2>N·ªôi dung</h2>
        <p>{{ manga.description|linebreaks }}</p>
    </div>

    <div class="chapter-list-section">
        <h2>Danh s√°ch ch∆∞∆°ng</h2>
        <div class="chapter-list">
            {% for chapter in chapters %}
            <div class="chapter-item">
                <a href="/manga/{{ manga.slug }}/{{ chapter.slug }}/">
                    <span class="chapter-name">
                        Chapter {{ chapter.chapter_number }}
                        {% if chapter.title %} - {{ chapter.title }}{% endif %}
                    </span>
                    <span class="chapter-meta">
                        <span class="chapter-views">üëÅ {{ chapter.views }}</span>
                        <span class="chapter-date">{{ chapter.created_at|date:"d/m/Y" }}</span>
                    </span>
                </a>
            </div>
            {% empty %}
            <p>Ch∆∞a c√≥ chapter n√†o.</p>
            {% endfor %}
        </div>
    </div>

    <div class="comments-section">
        <h2>B√¨nh lu·∫≠n</h2>

        {% if user.is_authenticated %}
        <form action="/comment/{{ manga.id }}/" method="post" class="comment-form">
            {% csrf_token %}
            <textarea name="content" placeholder="Vi·∫øt b√¨nh lu·∫≠n..." rows="4" required></textarea>
            <button type="submit" class="btn btn-primary">G·ª≠i b√¨nh lu·∫≠n</button>
        </form>
        {% else %}
        <p><a href="/auth/login/?next={{ request.path }}">ƒêƒÉng nh·∫≠p</a> ƒë·ªÉ b√¨nh lu·∫≠n</p>
        {% endif %}

        <div class="comment-list">
            {% for comment in comments %}
            <div class="comment-item">
                <div class="comment-header">
                    <strong>{{ comment.user.username }}</strong>
                    <span class="comment-date">{{ comment.created_at|date:"d/m/Y H:i" }}</span>
                </div>
                <div class="comment-content">
                    {{ comment.content }}
                </div>
            </div>
            {% empty %}
            <p>Ch∆∞a c√≥ b√¨nh lu·∫≠n n√†o.</p>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}